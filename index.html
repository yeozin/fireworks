<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>firework</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: black; /* 배경을 검은색으로 설정 */
        }
        .video {
            position: absolute;
            width: 200px; /* 비디오 크기를 작게 설정 */
            height: 112px;
        }
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1; /* 캔버스가 비디오 위에 오도록 설정 */
        }
    </style>
</head>
<body>

<!-- 불꽃놀이를 그릴 캔버스 -->
<canvas id="canvas"></canvas>
<audio id="myAudio">
    <source src="firework.mp3" type="audio/mpeg">
  </audio>

<script>
    // 캔버스 설정
    const canvas = document.getElementById('canvas');
    const context = canvas.getContext('2d');

    // 캔버스 크기 설정
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // 창 크기가 변경되면 캔버스 크기 조정
    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });

    // 비디오 소스 배열
    const videos = [
        'nico.mp4',  
        'run.mp4',
    ];

    // 불꽃놀이 입자 설정
    const particles = [];

    class Particle {
        constructor(x, y) {
            this.x = x; // 마우스 클릭 위치에서 불꽃놀이 발생
            this.y = y;
            this.vx = (Math.random() - 0.5) * 15;
            this.vy = (Math.random() - 0.5) * 15;
            this.size = Math.random() * 1 + 2;
            this.color = 'rgba(255, 255, 255, 0.8)'; // 빛나는 흰색 불꽃
        }

        update() {
            this.x += this.vx;
            this.y += this.vy;

            this.vy += 0.08;

            if (this.size > 0.5) this.size -= 0.01; // 점점 작아짐
        }

        draw() {
            context.beginPath();
            context.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            context.fillStyle = this.color;
            context.fill();
            context.closePath();
        }
    }

    // 불꽃놀이 생성 (위치 추가)
    function createFireworks(x, y) {
    const numberOfParticles = 100; // 입자의 수
    const angleStep = (Math.PI * 2) / numberOfParticles; // 각 입자 사이의 각도

    for (let i = 0; i < numberOfParticles; i++) {
        const angle = angleStep * i; // 현재 각도
        const speed = Math.random() * 8 + 2; // 입자의 속도 (2~10 범위)
        
        const particle = new Particle(
            x, // 시작 x 좌표
            y, // 시작 y 좌표
            Math.cos(angle) * speed, // x 방향 속도
            Math.sin(angle) * speed  // y 방향 속도
        );

        particles.push(particle);
    }
}

    // 애니메이션 루프
    function animate() {
        // 캔버스 지우기
        context.clearRect(0, 0, canvas.width, canvas.height);
        
        // 불꽃놀이 입자 업데이트 및 그리기
        particles.forEach((particle, index) => {
            particle.update();
            particle.draw();
            if (particle.size <= 1) {
                particles.splice(index, 1); // 크기가 작아진 입자는 제거
            }
        });

        requestAnimationFrame(animate);
    }

    let audioPlayed = false; // 오디오가 재생되었는지 확인하는 변수

    // 클릭 시 비디오를 생성하고 불꽃놀이도 발생시킴
    document.addEventListener('click', (e) => {
        // 처음 클릭 시 오디오 재생
        if (!audioPlayed) {
            const audio = document.getElementById('myAudio');
            audio.play();
            audioPlayed = true; // 오디오가 재생되었음을 표시
        }


        // 비디오 요소 생성
        const video = document.createElement('video');
        video.classList.add('video');
        video.muted = true;
        video.loop = true;

        // 비디오 소스를 랜덤하게 선택
        const randomIndex = Math.floor(Math.random() * videos.length);
        const source = document.createElement('source');
        source.src = videos[randomIndex]; // 랜덤으로 선택된 비디오
        source.type = 'video/mp4';
        video.appendChild(source);

        // 비디오 크기를 랜덤하게 설정 (예: 100px ~ 300px)
        const randomWidth = Math.floor(Math.random() * 201) + 100; // 100~300px
        const randomHeight = (randomWidth * 112) / 200; // 비율 유지

        video.style.width = `${randomWidth}px`;
        video.style.height = `${randomHeight}px`;

        // 비디오를 문서에 추가
    document.body.appendChild(video); // 비디오를 문서에 추가

    // 비디오가 로드된 후 너비와 높이를 계산하여 중앙에 배치
    video.onloadedmetadata = () => {
        const videoWidth = video.offsetWidth;
        const videoHeight = video.offsetHeight;

        // 비디오를 커서 중앙에 배치 (비디오 너비와 높이의 절반을 빼줌)
        video.style.left = `${e.pageX - videoWidth / 2}px`;
        video.style.top = `${e.pageY - videoHeight / 2}px`;
        
        video.play(); // 비디오 재생
    };

        // 클릭한 위치에서 불꽃놀이 터뜨리기
        createFireworks(e.pageX, e.pageY); // x, y 전달

        // 2초 후에 비디오 제거
        setTimeout(() => {
            document.body.removeChild(video);
        }, 10000); // 2000 밀리초 (2초) 후에 비디오 제거
    });

    // 애니메이션 시작
    animate();

</script>

</body>
</html>
